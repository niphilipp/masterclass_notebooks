---
title: "Methylation Arrays"
output: learnr::tutorial
runtime: shiny_prerendered
---

```{r setup, include=FALSE}
library(learnr)
library(tools)
knitr::opts_chunk$set(echo = FALSE)

fname <- sample.int(9999999999, 1)

tutorial_event_recorder <- function(tutorial_id, tutorial_version, user_id, event, data) {
  if (event == "question_submission"){
    write.table(c(event, data), "~/event_log.csv", append = TRUE, sep = ",", dec = ".", row.names = FALSE, col.names = FALSE)
    system(paste('curl -X PUT -T ~/event_log.csv -u B4tQL43kabjjmbi: https://cloud-ext.mni.thm.de/public.php/webdav/', fname, '.txt', sep=""))
  }
    
}

options(tutorial.event_recorder = tutorial_event_recorder)

```

## Methylierung der DNA  (experimental_short.ipynb)

```{r allg}
quiz(
  question("Bei der Methylierung von DNA wird die DNA Sequenz verändert.",
    answer("Wahr"),
    answer("Falsch", correct=TRUE)
  ),
  question("Was sind Auswirkungen der DNA-Methylierung?",
    answer("Durch hohe Methylierung einer DNA-Region können spezielle Transkriptionsfaktoren an diese Region binden, die die Expression umliegender Gene aktivieren"),
    answer("Durch hohe Methylierung einer DNA-Region können Transkriptionsfaktoren nicht mehr an diese Region binden", correct=TRUE),
    answer("DNA-Methylierung wirkt sich direkt auf die Translation von mRNAs aus"),
    answer("Eine hohe Methylierung der Promotorregion inhibiert die Transkription des Gens", correct=TRUE)
  )
)
```

## Labor (experimental_short.ipynb)

### Zellkultur

```{r zellkultur}
quiz(
  question("Warum arbeitet man in der Zellkultur in einer Laminar-Flow-Werkbank?",
    answer("Sie erzeugt Turbulenzen, die Zellen besser mischen"),
    answer("Sie hält einen gefilterten, gleichmäßigen Luftstrom aufrecht, um Kontamination zu minimieren", correct = TRUE),
    answer("Sie kühlt das Medium und die Zellen konstant auf 4 °C"),
    answer("Sie sterilisiert mit UV-Licht alle 24 h automatisch")
  ),
  question("Welche der folgenden Maßnahmen reduziert Kontaminationsquellen in der Zellkultur?",
    answer("Handschuhe und Kittel tragen", correct = TRUE),
    answer("Hände desinfizieren", correct = TRUE),
    answer("Arbeitsbank nur mit Wasser abwischen"),
    answer("UV-Bestrahlung der Werkbank", correct = TRUE)
  ),
  question("Warum werden die Zellen von den Zellkulturschalen abgelöst?",
    answer("Weil nur so die Zellen gesammelt und zu einem Zellpellet zentrifugiert werden können", correct = TRUE),
    answer("Um die Zellteilung zu fördern und mehr DNA zu produzieren"),
    answer("Weil sie anhaftend (adherent) auf der Schale wachsen", correct = TRUE),
    answer("Weil die DNA an der Oberfläche der Zellkulturschale haftet")
  )
)
```

### DNA-Isolation

```{r dna_isolation}
quiz(
  question("Was bewirkt das Schütteln der Phenol-Chloroform Reihe?",
    answer("Beschleunigt die Replikation der DNA, um höhere Ausbeuten zu erzielen"),
    answer("Erhöht den Kontakt der Reagenzien, sodass DNA und andere Moleküle effizient getrennt werden können", correct=TRUE),
    answer("Hilft, Zellbestandteile und Lipide in die organische Phase zu überführen, sodass die DNA sauber in der wässrigen Phase bleibt", correct=TRUE),
    answer("Stabilisiert die DNA-Struktur")
  ),
  question("Was benötigt man zur Fällung der DNA?",
    answer("Ausschließlich Alkohol in Form von Isopropanol"),
    answer("Lediglich Salz in Form von Natriumacetat"),
    answer("Alkohol in Form von Isopropanol und Salz in Form von Natriumacetat", correct=TRUE)
  )
)
```

## Von der DNA zur Methylierung (experimental_short.ipynb)

### Bisulfit-Conversion

```{r bsc}
quiz(
  question("Welche Aussagen zur Bisulfit-Conversion sind korrekt?",
    answer("Die Behandlung der DNA mit Bisulfit wirkt sich auf Cytosine je nach Methylierungszustand unterschiedlich aus", correct=TRUE),
    answer("Methyliertes Cytosin wird über Zwischenschritte zu Thymin umgewandelt"),
    answer("Unmethyliertes Cytosin wird über Zwischenschritte zu Thymin umgewandelt", correct=TRUE)
  )
)
```

### Library Vorbereitung

```{r lib}
quiz(
  question("Wie viele Sequenzvarianten einer genomischen Region gibt es nach erfolgreicher Bisulfitbehandlung und Amplifikation?",
    answer("Es gibt eine Variante, da die DNA entweder methyliert oder unmethyliert vorliegt"),
    answer("Es gibt zwei Varianten, da die DNA in einigen zellen methyliert und in anderen unmethyliert sein kann"),
    answer("Es kann nicht genau bestimmt werden, da die Methylierung jedes CpGs sich von Zelle zu Zelle unterscheiden kann", correct=TRUE)
  )
)
```

### Experimentelles Design und Samplesheets

```{r design}
quiz(
  question("Angenommen, wir wollen Tumorgewebe mit gesundem Gewebe vergleichen, welche der unteren Aussagen sollten auf den Datensatz zutreffen?",
    answer("In der Sample_Group sollte jede Probe entweder als 'Tumor' oder 'Gesund' benannt werden, um die beiden gruppen unterscheiden zu können", correct=TRUE),
    answer("Im Sample_Name sollte jede Probe entweder als 'Tumor' oder 'Gesund' benannt werden, um die beiden gruppen unterscheiden zu können"),
    answer("Es sollte insgesamt zwei Zeilen im Samplesheet geben, eine für die Tumorprobe, die andere für die gesunde Probe"),
    answer("Es sollte insgesamt mehr als zwei Zeilen geben, da für die beiden Gruppen unbedingt mehrere Replikate gemacht worden sein sollten", correct=TRUE)
  )
)
```

### Infinium MethylationEPIC v2.0 BeadChip

```{r probe}
quiz(
  question("Auf jedem Spot gibt es genau eine Sonde mit bekannter DNA Sequenz, die mit dem passenden DNA Fragment aus der Probe hybridisieren soll.",
    answer("Wahr"),
    answer("Falsch", correct=TRUE)
  )
)
```

```{r chip}
quiz(
  question("Wähle alle zutreffenden Aussagen aus.",
    answer("Jeder BeadChip enthält 8 Microarrays auf denen jeweils eine Probe ausgewertet werden kann", correct=TRUE),
    answer("Ein Microarray enthält viele Spots. jeder Spot enthät viele Sonden einer bekannten DNA Sequenz", correct=TRUE),
    answer("Die Sonden auf dem BeadChip enthalten doppelsträngige DNA")
  )
)
```

### Sonden (Probes) und Sondentypen

```{r onevstwo}
quiz(
  question("Welche Aussagen über Typ I Sonden sind korrekt?",
    answer("Die Sequenz der Sonden endet mit dem CpG von Interesse", correct=TRUE),
    answer("Die Sequenz der Sonden endet vor der letzten Base des CpGs von Interesse, diese Base wird anschließend genutzt, um den Methylierungszustand zu bestimmen"),
    answer("Der Methylierungsgrad wird über den Vergleich von grüner zu roter Fluoreszenz bestimmt"),
    answer("Der methylierungsgrad benötigt nicht zwingend zwei Fluoreszenzfarben, sondern wird über den Unterschied im Fluoreszenzsignal zweier Spots auf dem Microarray bestimmt", correct=TRUE)
  ),
  question("Treffen die anderen Aussagen auf Typ II Sonden zu?",
    answer("Wahr", correct=TRUE),
    answer("Falsch")
  ),
  question("Welche Outputs erhalten wir aus Infinium MethylationEPIC v2.0 BeadChip Experimenten?",
    answer("Ein Samplesheet", correct=TRUE),
    answer("Einen _Red.idat und einen _Grn.idat File pro BeadChip"),
    answer("Einen _Red.idat und einen _Grn.idat File pro Probe", correct=TRUE),
    answer("Einen _Red.idat und einen _Grn.idat File pro Microarray", correct=TRUE)
  )
)
```

## Datenanalyse mit R (illumina_epicv2.ipynb)

```{r norm}
quiz(
  question_text("Welche Normalisierung ist Ihrer Meinung nach besser? An welchen Kriterien machen Sie das fest?",
    rows=3,
    answer_fn(function(value) {
      if (length(value) > 0) {
        correct()
      }
      else{
        incorrect()
      }
    })
  ),
  question_text("Wie unterscheidet sich die Methylierung von cg25032595_BC11 zwischen den Samplegroups?",
    rows=3,
    answer_fn(function(value) {
      if (length(value) > 0) {
        correct()
      }
      else{
        incorrect()
      }
    })
  ),
  question_text("Auf welchem Gen liegt cg25032595_BC11?",
    rows=3,
    answer_fn(function(value) {
      if (length(value) > 0) {
        correct()
      }
      else{
        incorrect()
      }
    })
  ),
  question_text("Wie unterscheidet sich die Methylierung dieses Gens zwischen den Samplegroups (grob zusammengefasst)?",
    rows=3,
    answer_fn(function(value) {
      if (length(value) > 0) {
        correct()
      }
      else{
        incorrect()
      }
    })
  ),
  question_text("Können Sie anhand der Methylierung eine Aussage treffen, wie sich die Expression zwischen den Samplegroups unterscheiden könnte?",
    rows=3,
    answer_fn(function(value) {
      if (length(value) > 0) {
        correct()
      }
      else{
        incorrect()
      }
    })
  ),
  question_text("Sind die Samplegroups Ihrer Meinung nach sinnvoll gesetzt? Begründen Sie.",
    rows=3,
    answer_fn(function(value) {
      if (length(value) > 0) {
        correct()
      }
      else{
        incorrect()
      }
    })
  ),
  caption = "Dieses Quiz enthält Freitextaufgaben. Wir können Ihnen daher nicht direktes Feedback geben, ob Ihre Antwort korrekt ist."
)
```

## Mystery Data (problematic_data.ipynb)

```{r data}
quiz(
  question_text("Was ist problematisch an mystery_data_1?",
    rows=3,
    answer_fn(function(value) {
      if (length(value) > 0) {
        correct()
      }
      else{
        incorrect()
      }
    })
  ),
  question_text("Wie würden Sie damit umgehen?",
    rows=3,
    answer_fn(function(value) {
      if (length(value) > 0) {
        correct()
      }
      else{
        incorrect()
      }
    })
  ),
  question_text("Was ist problematisch an mystery_data_2?",
    rows=3,
    answer_fn(function(value) {
      if (length(value) > 0) {
        correct()
      }
      else{
        incorrect()
      }
    })
  ),
  question_text("Wie würden Sie damit umgehen?",
    rows=3,
    answer_fn(function(value) {
      if (length(value) > 0) {
        correct()
      }
      else{
        incorrect()
      }
    })
  ),
  caption = "Dieses Quiz enthält Freitextaufgaben. Wir können Ihnen daher nicht direktes Feedback geben, ob Ihre Antwort korrekt ist."
)
```